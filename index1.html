<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="ljk.png" type="image/png">
<title>SmartMove | Cerere Ofertă</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>

<a href="https://wa.me/40767107084?text=Salut!%20Vreau%20o%20ofertă%20rapidă." class="whatsapp-mini" target="_blank">
    <i class="fab fa-whatsapp" style="font-size: 18px;"></i>
    <span>WhatsApp Rapid</span>
</a>

<header class="main-header sticky">
    <div class="logo-container">
        <a href="index.html" style="display: flex; align-items: center; text-decoration: none;">
            <img class="brand-logo" src="ljk.png" alt="Logo">
            <div class="logo-text-stack">
                <span class="site-name main-title">SmartMove</span>
                <span class="sub-title">by LJK Transport</span>
            </div>
        </a>
    </div>
    
    <nav class="main-nav">
        <a href="index.html">Acasă</a>
        <a href="index.html#calculator-section">Calculator Rapid</a> 
        <a href="index1.html" class="active nav-btn-highlight">Cerere Ofertă</a>
        <a href="index.html#contact-section">Contact</a>
    </nav>
    <div class="mobile-menu-icon" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
</header>

<section class="request-form-section">
    <div class="section-title" data-aos="fade-down">
        <h2>Configurare <span class="highlight">Transport</span></h2>
        <p>Completează detaliile pentru o ofertă precisă.</p>
    </div>

    <div class="glass-form-container" data-aos="fade-up">
        <form id="offerForm" onsubmit="event.preventDefault();">
            <div class="calculator-grid">

                <div class="client-details">
                    <h3 style="margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom:10px;">1. Detalii Generale</h3>
                    <div class="modern-form">
                        <div class="input-group">
                            <input type="text" id="nume" placeholder=" " required>
                            <label>Nume Client</label>
                        </div>
                        <div class="input-group">
                            <input type="tel" id="telefon" placeholder=" " required>
                            <label>Telefon</label>
                        </div>
                        <div class="input-group">
                            <input type="email" id="emailClient" placeholder=" " required>
                            <label>Email (pentru confirmare)</label>
                        </div>
                        
                        <div class="input-group" style="margin-top:15px;">
                            <input type="date" id="dataMutare" required style="color: #444;">
                            <label style="background:#fff; padding:0 5px;">Dată Dorită Mutare</label>
                        </div>
                    </div>

                    <h3 style="margin: 30px 0 20px; border-bottom: 2px solid #eee; padding-bottom:10px;">2. Traseu & Adrese Exacte</h3>
                    <div class="modern-form">
                        
                        <div class="input-group">
                            <select id="tipLocatie" class="custom-select" onchange="schimbaTipLocatie()">
                                <option value="local">Local (Brașov Oraș)</option>
                                <option value="metro">Metropolitan (Împrejurimi)</option>
                                <option value="national">Național (Exterior)</option>
                            </select>
                            <label style="top: -10px; left: 10px; font-size: 0.8rem; background: #fff; padding: 0 5px; color: var(--primary);">Tip Transport</label>
                        </div>

                        <div class="input-group hidden" id="divMetro" style="margin-top: 15px;">
                            <select id="listaMetro" class="custom-select" onchange="calculeazaTotal()">
                                <option value="0">Alege Localitatea...</option>
                                <option value="120">Poiana Brașov (120 Lei)</option>
                                <option value="120">Cristian, Hărman, Stupini (120 Lei)</option>
                                <option value="120">Ghimbav, Sânpetru, Săcele (120 Lei)</option>
                                <option value="150">Bran, Râșnov, Codlea (150 Lei)</option>
                                <option value="200">Fundata, Zărnești (200 Lei)</option>
                            </select>
                        </div>

                        <div id="divTraseuGoogle" class="hidden" style="margin-top: 15px; margin-bottom: 20px; background: #f0f7ff; padding: 15px; border-radius: 10px; border: 1px solid #cce5ff;">
                            <div class="input-group" style="margin-bottom: 15px;">
                                <input type="text" id="routeStart" placeholder=" ">
                                <label>Localitate Plecare (Oraș)</label>
                            </div>
                            <div class="input-group">
                                <input type="text" id="routeEnd" placeholder=" ">
                                <label>Localitate Sosire (Oraș)</label>
                            </div>
                            <div style="font-weight: bold; color: var(--brand-blue); font-size: 0.9rem; margin-top: 10px;">
                                <i class="fas fa-road"></i> Distanță: <span id="distantaText">0 km</span>
                            </div>
                        </div>

                        <div style="background: #fff; padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-top: 20px;">
                            <h4 style="margin-bottom:15px; font-size:1rem; color:#333;"><i class="fas fa-map-marker-alt" style="color:green;"></i> Punct Încărcare (Plecare)</h4>
                            <div class="input-group">
                                <input type="text" id="adresaPlecareExacta" placeholder=" " required>
                                <label>Adresa Exactă (Strada, Nr, Bloc, Scara)</label>
                            </div>
                            <div class="floor-section" style="display: flex; gap: 15px; align-items: center;">
                                <div class="input-group" style="margin-bottom:0; flex: 1;">
                                    <input type="number" id="etajPlecare" placeholder=" " min="0" max="20" oninput="calculeazaTotal()">
                                    <label>Etaj</label>
                                </div>
                                <label class="checkbox-group" style="flex: 1; margin:0;">
                                    <input type="checkbox" id="liftPlecare" onchange="calculeazaTotal()">
                                    <span>Are Lift?</span>
                                </label>
                            </div>
                        </div>

                        <div style="background: #fff; padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-top: 15px;">
                            <h4 style="margin-bottom:15px; font-size:1rem; color:#333;"><i class="fas fa-flag-checkered" style="color:red;"></i> Punct Descărcare (Sosire)</h4>
                            <div class="input-group">
                                <input type="text" id="adresaSosireExacta" placeholder=" " required>
                                <label>Adresa Exactă (Strada, Nr, Bloc, Scara)</label>
                            </div>
                            <div class="floor-section" style="display: flex; gap: 15px; align-items: center;">
                                <div class="input-group" style="margin-bottom:0; flex: 1;">
                                    <input type="number" id="etajSosire" placeholder=" " min="0" max="20" oninput="calculeazaTotal()">
                                    <label>Etaj</label>
                                </div>
                                <label class="checkbox-group" style="flex: 1; margin:0;">
                                    <input type="checkbox" id="liftSosire" onchange="calculeazaTotal()">
                                    <span>Are Lift?</span>
                                </label>
                            </div>
                        </div>

                    </div>

                    <h3 style="margin: 30px 0 20px; border-bottom: 2px solid #eee; padding-bottom:10px;">3. Servicii Manipulare</h3>
                    <div class="radio-options">
                        <label class="radio-label">
                            <input type="radio" name="ajutor" value="nu" checked onchange="calculeazaTotal()">
                            <span>Nu doresc manipulare (Am ajutor)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="ajutor" value="da" onchange="calculeazaTotal()">
                            <span>Doresc hamali (Manipulare inclusă)</span>
                        </label>
                    </div>
                </div>

                <div class="load-details">
                    <h3 style="margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom:10px;">4. Lista Obiecte</h3>
                    
                    <div class="van-visual-container">
                        <h4 id="vanTitle" style="margin-bottom:10px; color:var(--dark-blue);">Grad de Încărcare</h4>
                        <div class="van-graphic">
                            <div class="cargo-box">
                                <div class="cargo-lines"></div>
                                <div class="fill-level" id="vanFill"></div>
                            </div>
                            <div class="cabin"></div>
                            <div class="wheel rear"></div>
                            <div class="wheel front"></div>
                            <div class="percent-text" id="fillPercent">0%</div>
                        </div>
                        <p style="font-size:0.9rem; color:#666; margin-top: 10px;">
                            <span id="infoVehicule">Vehicul 1:</span>
                            <strong id="totalVolDisplay">0.00</strong> / <span id="capMaximaDisplay">9.12</span> m³
                        </p>
                        <div id="warningMsg" class="warning-box"></div>
                        
                        <button type="button" id="btnEliminaVan" class="button btn-outline hidden" onclick="eliminaVehicul()" style="margin-top:15px; color: red; border-color: red;">
                            <i class="fas fa-trash-alt"></i> Renunță la Vehicul 2
                        </button>
                        <button type="button" id="btnExtraVan" class="button btn-outline hidden" onclick="adaugaVehicul()" style="margin-top:10px;">
                            <i class="fas fa-truck-medical"></i> Mai am marfă (Vehicul 2)
                        </button>
                        <a href="index.html#contact-section" id="btnContactUrgent" class="button btn-glow hidden" style="background:red; margin-top:10px;">
                            <i class="fas fa-phone"></i> Sună-ne (Volum depășit)
                        </a>
                    </div>

                    <p style="font-size:0.9rem; margin-bottom:10px; font-weight:600; margin-top: 20px;">Adaugă dimensiuni (L x l x h):</p>
                    
                    <div class="dims-inputs modern-form" style="display: flex; gap: 10px; align-items: stretch;">
                        <div class="input-group" style="margin-bottom:0; flex: 1;">
                            <input id="lungime" type="number" step="0.01" placeholder=" ">
                            <label>Lungime (cm)</label>
                        </div>
                        <div class="input-group" style="margin-bottom:0; flex: 1;">
                            <input id="latime" type="number" step="0.01" placeholder=" ">
                            <label>Lățime (cm)</label>
                        </div>
                        <div class="input-group" style="margin-bottom:0; flex: 1;">
                            <input id="inaltime" type="number" step="0.01" placeholder=" ">
                            <label>Înălțime (cm)</label>
                        </div>
                        <button type="button" onclick="adaugaSiVerifica()" class="add-dim-btn" style="height: 56px; width: 56px; flex-shrink: 0;">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <div class="table-container">
                        <table id="corpuriTable">
                            <thead><tr><th>#</th><th>Dimensiuni</th><th>Volum</th><th>Sterge</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="zonaRezultat" style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                <div class="result-box-highlight" id="boxPret" style="display:block; border: 2px dashed var(--primary);">
                    <h3 style="color:var(--dark-blue);">Preț Estimativ:</h3>
                    <span class="total-price-tag" style="color:var(--brand-red); font-size: 3.5rem;">
                        <span id="pretFinal">100</span> LEI
                    </span>
                    <div id="detaliiDiscount" style="color:green; font-weight:bold; display:none;">
                        <i class="fas fa-check-circle"></i> Discount 5% pentru flotă!
                    </div>
                    <p style="font-size:0.8rem; color:#888; margin-top:10px;">*Prețul este orientativ și se confirmă telefonic.</p>
                </div>

                <div id="msgNationalError" class="result-box-highlight hidden" style="background: #fff8f8; border: 2px solid red; color: red;">
                    <h3><i class="fas fa-exclamation-circle"></i> Traseu Complex</h3>
                    <p>Contactează-ne pentru o ofertă personalizată pe distanțe lungi.</p>
                    <a href="tel:0767107084" class="button btn-glow" style="margin-top:10px;">Sună Acum</a>
                </div>

                <button type="button" onclick="trimiteCerere()" class="button btn-glow" style="width: 100%; max-width: 400px; font-size: 1.2rem; margin-top:20px;">
                    Trimite Comanda Fermă <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </form>
    </div>
</section>

<footer><p>© 2025 SmartMove by LJK TRANSPORT.</p></footer>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWzc3R6DfkoKbVMIQnucgHbf3QPtz_wBM&libraries=places&callback=initMap" async defer></script>

<script>
AOS.init();
function toggleMenu() { document.querySelector('.main-nav').classList.toggle('active'); }

// --- CONFIGURARE ---
(function() { emailjs.init("jFVSCsGCl98ogZ4eQ"); })(); // Public Key
const EMAIL_ADMIN = "stefanpricopi07@gmail.com"; 
// -------------------

const MAX_L = 3.5; const MAX_l = 1.4; const MAX_h = 1.9;
const CAPACITATE_DUBA_REALA = 9.31;
const CAPACITATE_UTILIZABILA = CAPACITATE_DUBA_REALA * 0.98;

let corpuri = [];
let nrVehicule = 1;
let maxVolumCurent = CAPACITATE_UTILIZABILA;
let kmCalculati = 0;

function salveazaProgres() {
    const data = {
        nume: document.getElementById("nume").value,
        telefon: document.getElementById("telefon").value,
        emailClient: document.getElementById("emailClient").value,
        dataMutare: document.getElementById("dataMutare").value, 
        tipLocatie: document.getElementById("tipLocatie").value,
        listaMetro: document.getElementById("listaMetro").value,
        routeStart: document.getElementById("routeStart").value,
        routeEnd: document.getElementById("routeEnd").value,
        adresaPlecareExacta: document.getElementById("adresaPlecareExacta").value,
        adresaSosireExacta: document.getElementById("adresaSosireExacta").value,
        etajPlecare: document.getElementById("etajPlecare").value,
        liftPlecare: document.getElementById("liftPlecare").checked,
        etajSosire: document.getElementById("etajSosire").value,
        liftSosire: document.getElementById("liftSosire").checked,
        ajutor: document.querySelector('input[name="ajutor"]:checked').value,
        corpuri: corpuri,
        nrVehicule: nrVehicule,
        kmCalculati: kmCalculati
    };
    localStorage.setItem("smartMoveData", JSON.stringify(data));
}

function incarcaProgres() {
    const saved = localStorage.getItem("smartMoveData");
    if (saved) {
        const d = JSON.parse(saved);
        document.getElementById("nume").value = d.nume || "";
        document.getElementById("telefon").value = d.telefon || "";
        document.getElementById("emailClient").value = d.emailClient || "";
        document.getElementById("dataMutare").value = d.dataMutare || "";
        document.getElementById("tipLocatie").value = d.tipLocatie || "local";
        document.getElementById("listaMetro").value = d.listaMetro || "0";
        document.getElementById("routeStart").value = d.routeStart || "";
        document.getElementById("routeEnd").value = d.routeEnd || "";
        document.getElementById("adresaPlecareExacta").value = d.adresaPlecareExacta || "";
        document.getElementById("adresaSosireExacta").value = d.adresaSosireExacta || "";
        document.getElementById("etajPlecare").value = d.etajPlecare || "";
        document.getElementById("liftPlecare").checked = d.liftPlecare;
        document.getElementById("etajSosire").value = d.etajSosire || "";
        document.getElementById("liftSosire").checked = d.liftSosire;
        
        const radios = document.getElementsByName("ajutor");
        radios.forEach(r => { if (r.value === d.ajutor) r.checked = true; });

        corpuri = d.corpuri || [];
        kmCalculati = d.kmCalculati || 0;
        if(kmCalculati > 0) document.getElementById("distantaText").innerText = kmCalculati + " km";
        if(d.nrVehicule === 2) adaugaVehicul(false);
        
        schimbaTipLocatie();
        updateUI();
        calculeazaTotal();
    }
}

document.addEventListener("DOMContentLoaded", () => {
    incarcaProgres();
    document.querySelectorAll("input, select").forEach(el => {
        el.addEventListener("input", salveazaProgres);
        el.addEventListener("change", salveazaProgres);
    });
});

function initMap() {
    const p = new google.maps.places.Autocomplete(document.getElementById("routeStart"));
    const s = new google.maps.places.Autocomplete(document.getElementById("routeEnd"));
    p.addListener("place_changed", () => { calculeazaDistantaGoogle(); salveazaProgres(); });
    s.addListener("place_changed", () => { calculeazaDistantaGoogle(); salveazaProgres(); });
}

function calculeazaDistantaGoogle() {
    const org = document.getElementById("routeStart").value;
    const dest = document.getElementById("routeEnd").value;
    if (org && dest) {
        new google.maps.DistanceMatrixService().getDistanceMatrix(
            { origins: [org], destinations: [dest], travelMode: 'DRIVING', unitSystem: google.maps.UnitSystem.METRIC },
            (resp, status) => {
                if (status === 'OK' && resp.rows[0].elements[0].status === "OK") {
                    kmCalculati = Math.ceil(resp.rows[0].elements[0].distance.value / 1000);
                    document.getElementById("distantaText").innerText = kmCalculati + " km";
                    calculeazaTotal();
                    salveazaProgres();
                }
            }
        );
    }
}

function schimbaTipLocatie() {
    const t = document.getElementById("tipLocatie").value;
    document.getElementById("divMetro").classList.toggle("hidden", t !== "metro");
    document.getElementById("divTraseuGoogle").classList.toggle("hidden", t !== "national");
    calculeazaTotal();
}

function calculeazaTotal() {
    let pret = 0;
    const t = document.getElementById("tipLocatie").value;
    if (t === "local") pret = 100;
    else if (t === "metro") {
        const v = parseFloat(document.getElementById("listaMetro").value);
        pret = v > 0 ? v : 100;
    } else if (t === "national") {
        pret = kmCalculati * 6;
        if (pret === 0) pret = 0;
    }

    const ep = parseInt(document.getElementById("etajPlecare").value) || 0;
    const es = parseInt(document.getElementById("etajSosire").value) || 0;
    const lp = document.getElementById("liftPlecare").checked;
    const ls = document.getElementById("liftSosire").checked;
    
    const costEtaj = (e, l) => (l || e<=0) ? 0 : (e<=2 ? 100 : (e<=6 ? 150 : 300));
    const costP = costEtaj(ep, lp);
    const costS = costEtaj(es, ls);
    pret += costP + costS;

    if (document.querySelector('input[name="ajutor"]:checked').value === "da") {
        pret += (costP + costS > 0) ? (costP + costS) : 50;
    }

    pret *= nrVehicule;
    if (nrVehicule > 1) {
        pret *= 0.95;
        document.getElementById("detaliiDiscount").style.display = "block";
    } else document.getElementById("detaliiDiscount").style.display = "none";

    const box = document.getElementById("boxPret");
    const err = document.getElementById("msgNationalError");
    if (t === "national" && nrVehicule > 1) {
        box.style.display = "none"; err.classList.remove("hidden");
    } else {
        box.style.display = "block"; err.classList.add("hidden");
        document.getElementById("pretFinal").innerText = Math.ceil(pret);
    }
}

function adaugaSiVerifica() {
    const L = parseFloat(document.getElementById("lungime").value);
    const l = parseFloat(document.getElementById("latime").value);
    const h = parseFloat(document.getElementById("inaltime").value);
    const w = document.getElementById("warningMsg");

    if (!L || !l || !h) { w.innerText = "Dimensiuni lipsă!"; w.style.color="red"; return; }
    
    // 1. Calcul volum direct în cm3
    const vol_cm3 = L * l * h; 
    // 2. Conversie în m3 pentru calculele de capacitate totală a dubei
    const vol_m3 = vol_cm3 / 1000000;

    // 3. Verificare dimensiuni maxime (Comparăm CM cu CM)
    // MAX_L, MAX_l, MAX_h sunt în metri, deci le înmulțim cu 100
    const dims = [L, l, h].sort((a,b)=>b-a);
    const maxs = [MAX_L*100, MAX_h*100, MAX_l*100].sort((a,b)=>b-a);
    
    if (dims[0] > maxs[0] || dims[1] > maxs[1] || dims[2] > maxs[2]) {
        w.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Obiect prea mare pentru dubă!`;
    } else w.innerText = "";
    
    // 4. Verificare depășire volum total (în m3)
    const total = corpuri.reduce((a,b)=>a+b.volum,0);
    if (total + vol_m3 > maxVolumCurent) {
        w.innerText = "Depășește capacitatea vehiculului!";
        if(nrVehicule<2) document.getElementById("btnExtraVan").classList.remove("hidden");
        else document.getElementById("btnContactUrgent").classList.remove("hidden");
        return;
    }
    
    // Salvăm în listă (volumul rămâne stocat în m3 pentru consistență, dar afișăm cm3)
    corpuri.push({L, l, h, volum: vol_m3});
    
    document.getElementById("lungime").value=""; 
    document.getElementById("latime").value=""; 
    document.getElementById("inaltime").value="";
    document.getElementById("lungime").focus();
    
    updateUI(); 
    salveazaProgres(); 
    calculeazaTotal();
}

function adaugaVehicul(s=true) {
    nrVehicule=2; maxVolumCurent=CAPACITATE_UTILIZABILA*2;
    document.getElementById("btnExtraVan").classList.add("hidden");
    document.getElementById("btnEliminaVan").classList.remove("hidden");
    document.getElementById("vanTitle").innerText="2 x Vehicule (Tandem)";
    updateUI(); if(s) salveazaProgres(); calculeazaTotal();
}
function eliminaVehicul() {
    if(nrVehicule>1) {
        nrVehicule=1; maxVolumCurent=CAPACITATE_UTILIZABILA;
        document.getElementById("btnEliminaVan").classList.add("hidden");
        document.getElementById("vanTitle").innerText="Grad de Încărcare";
        updateUI(); salveazaProgres(); calculeazaTotal();
    }
}
function stergeCorp(i) {
    corpuri.splice(i,1); updateUI(); salveazaProgres(); calculeazaTotal();
}

function updateUI() {
    const tb = document.querySelector("#corpuriTable tbody");
    tb.innerHTML = "";
    corpuri.forEach((c,i) => {
        // Conversie inversă pentru afișare: m3 -> cm3
        const afisaj_cm3 = (c.volum * 1000000).toFixed(0); 
        
        tb.innerHTML += `
            <tr>
                <td>${i+1}</td>
                <td>${c.L} x ${c.l} x ${c.h} cm</td>
                <td>${afisaj_cm3} cm³</td>
                <td><button style="background:red;color:white;border:none;border-radius:4px;cursor:pointer;padding:2px 6px;" onclick="stergeCorp(${i})">X</button></td>
            </tr>`;
    });

    const total = corpuri.reduce((a,b)=>a+b.volum,0); // Totalul rămâne în m3
    const p = (total/maxVolumCurent)*100;
    
    document.getElementById("totalVolDisplay").innerText = total.toFixed(2);
    document.getElementById("capMaximaDisplay").innerText = maxVolumCurent.toFixed(2);
    document.getElementById("fillPercent").innerText = p.toFixed(0)+"%";
    document.getElementById("vanFill").style.width = p+"%";
}

function trimiteCerere() {
    const n = document.getElementById("nume").value;
    const t = document.getElementById("telefon").value;
    const e = document.getElementById("emailClient").value;
    const dataM = document.getElementById("dataMutare").value; 
    const adresa1 = document.getElementById("adresaPlecareExacta").value;
    const adresa2 = document.getElementById("adresaSosireExacta").value;
    
    if(!n || !t || !e || !adresa1 || !adresa2 || !dataM) {
        alert("Toate câmpurile (inclusiv Adresele și Data) sunt obligatorii!");
        return;
    }

    const btn = document.querySelector("#zonaRezultat button");
    btn.innerHTML = 'Se trimite...'; btn.disabled = true;

    // --- MODIFICARE AICI: Generare listă în cm³ ---
    let lista = "";
    if(corpuri.length) {
        corpuri.forEach((c,i)=> {
            // Convertim volumul din m³ în cm³ pentru afișarea în email
            const vol_cm3 = (c.volum * 1000000).toFixed(0);
            lista += `<tr><td>${i+1}</td><td>${c.L}x${c.l}x${c.h} cm</td><td>${vol_cm3} cm³</td></tr>`;
        });
    } else {
        lista = "<tr><td colspan='3'>Doar Transport (Fără listă obiecte)</td></tr>";
    }
    // ----------------------------------------------

    const params = {
        nume: n, telefon: t, 
        email: e, user_email: e, to_email: e, reply_to: e, 
        
        data_mutare: dataM,
        
        adresa_plecare: adresa1,
        etaj_plecare: document.getElementById("etajPlecare").value || "Parter",
        lift_plecare: document.getElementById("liftPlecare").checked ? "DA" : "NU",
        
        adresa_sosire: adresa2,
        etaj_sosire: document.getElementById("etajSosire").value || "Parter",
        lift_sosire: document.getElementById("liftSosire").checked ? "DA" : "NU",
        
        distanta: kmCalculati > 0 ? kmCalculati + " km" : "Local/Metro",
        manipulare: document.querySelector('input[name="ajutor"]:checked').value === "da" ? "DA" : "NU",
        
        vehicule: nrVehicule,
        // Totalul îl lăsăm în m³ pentru că e mai relevant pentru capacitatea dubei
        volum_total: document.getElementById("totalVolDisplay").innerText + " m³", 
        pret_total: document.getElementById("pretFinal").innerText,
        
        tabel_obiecte: lista
    };

    emailjs.send('service_wj3tmfj', 'template_ximdn9c', params)
        .then(() => {
            const adminP = {...params}; 
            adminP.email = EMAIL_ADMIN; adminP.user_email = EMAIL_ADMIN; adminP.to_email = EMAIL_ADMIN;
            return emailjs.send('service_wj3tmfj', 'template_ximdn9c', adminP);
        })
        .then(() => {
            alert("Succes! Verifică emailul.");
            localStorage.removeItem("smartMoveData"); location.reload();
        })
        .catch(err => { 
            alert(JSON.stringify(err)); 
            btn.disabled=false; 
            btn.innerHTML='Trimite Comanda Fermă <i class="fas fa-paper-plane"></i>'; 
        });
}
</script>
</body>
</html>